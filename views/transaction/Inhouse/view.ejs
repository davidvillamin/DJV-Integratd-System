<%- include("../../partials/header") %>
<%- include("../../partials/header-sidebar") %>
<%- include("../../partials/loading") %>
<!-- tih - Transaction Inhouse View -->
<main id="main" class="main">
    <div class="pagetitle d-flex mb-0 align-items-end">
        <nav>
            <h1 id="tihName"></h1>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/transaction">Transaction</a></li>
                <li class="breadcrumb-item active">Inhouse</li>
            </ol>
        </nav>
        <i class="bi bi-three-dots-vertical ms-auto" data-bs-toggle="dropdown" aria-expanded="false"></i>

        <ul class="dropdown-menu">
            <li><a class="dropdown-item" data-bs-target="#tihSupplyModal" data-bs-toggle="modal">Quotation</a></li>
            <li><a class="dropdown-item" data-bs-target="#tihExpensesModal" data-bs-toggle="modal">Approval</a></li>
            <li><a class="dropdown-item" data-bs-target="#tihPaymentModal" data-bs-toggle="modal">Complete</a></li>
        </ul>
    </div><!-- End Page Title -->
    <div class="container my-2">
        <div class="progress" role="progressbar" aria-label="Animated striped example" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-info text-bg-info" style="width: 25%">
                Repair
            </div>
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary text-bg-primary" style="width: 25%">
                Quotation
            </div>
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning text-bg-warning" style="width: 25%">
                Approval
            </div>
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success text-bg-success" style="width: 25%">
                Complete
            </div>
        </div>
    </div>
    
    <section class="section profile">
        <div class="row">
            <!-- =====================left side ===================-->
             <!-- legend: tiho - transaction inhouse overview -->
            <div class="col-xl-3">
                <!-- Over View -->
                <div class="card">
                    <div class="card-header">
                        Overview
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            Payment
                            <p class="m-0">₱ 0.00</p>
                        </div>
                        <div class="d-flex justify-content-between">
                            <strong>Balance</strong>
                            <strong><span>₱ </span>0.00</strong>
                        </div>
                        <hr class="my-1">
                        <div class="d-flex justify-content-between">
                            Total
                            <p class="m-0" id="tihoTotal"></p>
                        </div>
                    </div>
                </div>
                <!-- tihc - transaction inhouse client -->
                <!-- Customer Information -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span>Customer Information</span>
                        <i class="bi bi-pencil-square ms-auto" data-bs-toggle="modal" data-bs-target="#cEditModal"></i>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4">
                                Name:
                            </div>
                            <div class="col-8">
                                <span id="tihcName"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Email:
                            </div>
                            <div class="col-8">
                                <span id="tihcEmail"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Contact Number:
                            </div>
                            <div class="col-8">
                                <span id="tihcContactNumber"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Address:
                            </div>
                            <div class="col-8">
                                <span id="tihcAddress"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Notes:
                            </div>
                            <div class="col-8">
                                <span id="tihcNotes"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Created Date:
                            </div>
                            <div class="col-8">
                                <span id="tihcCreatedDate"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- tihd - transaction inhouse device -->
                <!-- Device Information -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span>Device Information</span>
                        <i class="bi bi-pencil-square ms-auto" data-bs-toggle="modal" data-bs-target="#cEditModal"></i>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4">
                                Name:
                            </div>
                            <div class="col-8">
                                <span id="tihdName"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Brand:
                            </div>
                            <div class="col-8">
                                <span id="tihdBrand"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Model:
                            </div>
                            <div class="col-8">
                                <span id="tihdModel"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Serial Number:
                            </div>
                            <div class="col-8">
                                <span id="tihdSerialNumber"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Created Date:
                            </div>
                            <div class="col-8">
                                <span id="tihdCreatedDate"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Documents -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span class="me-auto">Documents</span>
                        <i class="bi bi-pencil-square" data-bs-toggle="modal" data-bs-target="#"></i>
                    </div>
                    <div class="card-body">
                        <span id="cvDocuments"></span>
                    </div>
                </div>
                
            </div>

            <!-- =====================Ceneter Content===================-->

            <div class="col-xl-6">
                <!-- Sales Transactions -->
                <!-- tihs - transaction inhouse sales -->
                <div class="card">
                    <div class="card-header d-flex dropstart">
                        <span class="me-auto">Sales Report</span>
                        <!-- <i class="bi bi-pencil-square" data-bs-toggle="modal" data-bs-target="#tihsrEditModal"></i> -->
                        <i class="bi bi-three-dots" data-bs-toggle="dropdown" aria-expanded="false"></i>

                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" data-bs-target="#tihProductModal" data-bs-toggle="modal">Product</a></li>
                            <li><a class="dropdown-item" data-bs-target="#tihExpensesModal" data-bs-toggle="modal">Expenses</a></li>
                            <li><a class="dropdown-item" data-bs-target="#tihPaymentModal" data-bs-toggle="modal">Payment</a></li>
                            <li><a class="dropdown-item" data-bs-target="#tihServiceChargeModal" data-bs-toggle="modal">Service Charge</a></li>
                            <li><a class="dropdown-item" data-bs-target="#" data-bs-toggle="modal">Discount</a></li>
                        </ul>
                    </div>
                   
                    <div class="card-body">
                        <table id="tihSalesTable" class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Name</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="3" class="text-center">There are no sales available.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>  
                </div>
                <!-- Tickets -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span class="me-auto">Service Report</span>
                        <i class="bi bi-floppy" data-bs-toggle="modal" data-bs-target="#"></i>
                    </div>
                    <div class="card-body">
                        <div id="tihServiceReport"></div>
                    </div>  
                </div>
            </div>
            <!-- =================right side ===================-->
            <div class="col-xl-3">
                <!-- appointments calendar -->
                <div class="card">
                    <div class="card-header">
                        Appointments
                    </div>
                    <div class="card-body">
                        <div id="miniCalendar" class="mini-calendar">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <button id="mcPrev" type="button" class="btn btn-sm btn-outline-secondary">&lt;</button>
                                <strong id="mcMonthYear" class="mx-2"></strong>
                                <button id="mcNext" type="button" class="btn btn-sm btn-outline-secondary">&gt;</button>
                            </div>

                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr id="mcWeekdays" class="text-center small"></tr>
                                </thead>
                                <tbody id="mcDates"></tbody>
                            </table>
                        </div>

                        <style>
                            .mini-calendar td, .mini-calendar th { width: 2.2rem; height: 2.2rem; padding: 0.15rem; }
                            .mini-calendar td button { width: 100%; height: 100%; border: none; background: transparent; }
                            .mini-calendar td .today { background-color: #0d6efd; color: #fff; border-radius: 0.25rem; }
                            .mini-calendar td .muted { color: #6c757d; }
                            .mini-calendar td button:hover { background-color: rgba(13,110,253,0.08); border-radius: 0.25rem; }
                        </style>

                        <script>
                            (function () {
                                const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
                                const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
                                const mcMonthYear = document.getElementById('mcMonthYear');
                                const mcWeekdays = document.getElementById('mcWeekdays');
                                const mcDates = document.getElementById('mcDates');
                                const prevBtn = document.getElementById('mcPrev');
                                const nextBtn = document.getElementById('mcNext');

                                // render weekdays header
                                mcWeekdays.innerHTML = weekdays.map(d => '<th>' + d + '</th>').join('');

                                let today = new Date();
                                let viewYear = today.getFullYear();
                                let viewMonth = today.getMonth(); // 0-11

                                function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }
                                function render(){
                                    mcMonthYear.textContent = monthNames[viewMonth] + ' ' + viewYear;
                                    mcDates.innerHTML = '';

                                    const firstDay = new Date(viewYear, viewMonth, 1).getDay(); // 0-6
                                    const totalDays = daysInMonth(viewYear, viewMonth);
                                    let row = document.createElement('tr');
                                    let dayCount = 0;

                                    // leading blanks
                                    for (let i=0; i<firstDay; i++){
                                        row.appendChild(document.createElement('td'));
                                        dayCount++;
                                    }

                                    for (let d=1; d<=totalDays; d++){
                                        if (dayCount === 7){
                                            mcDates.appendChild(row);
                                            row = document.createElement('tr');
                                            dayCount = 0;
                                        }
                                        const td = document.createElement('td');
                                        const btn = document.createElement('button');
                                        btn.type = 'button';
                                        btn.textContent = d;

                                        // mark today
                                        if (viewYear === today.getFullYear() && viewMonth === today.getMonth() && d === today.getDate()){
                                            btn.classList.add('today');
                                        }

                                        btn.addEventListener('click', () => {
                                            // simple click behavior: highlight selected date and you can hook into appointment logic here
                                            const prev = mcDates.querySelectorAll('button.selected');
                                            prev.forEach(p => p.classList.remove('selected'));
                                            btn.classList.add('selected');
                                        });

                                        td.appendChild(btn);
                                        row.appendChild(td);
                                        dayCount++;
                                    }

                                    // trailing blanks
                                    while(dayCount > 0 && dayCount < 7){
                                        row.appendChild(document.createElement('td'));
                                        dayCount++;
                                    }
                                    mcDates.appendChild(row);
                                }

                                prevBtn.addEventListener('click', () => {
                                    viewMonth--;
                                    if (viewMonth < 0){ viewMonth = 11; viewYear--; }
                                    render();
                                });
                                nextBtn.addEventListener('click', () => {
                                    viewMonth++;
                                    if (viewMonth > 11){ viewMonth = 0; viewYear++; }
                                    render();
                                });

                                render();
                            })();
                        </script>
                    </div>
                </div>
                <!-- Images -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span class="me-auto">Images</span>
                        <i class="bi bi-pencil-square" data-bs-toggle="modal" data-bs-target="#"></i>
                    </div>
                    <div class="card-body">
                        <p class="fst-italic mb-0">No images available.</p>
                    </div>
                </div>
                <!-- Notes -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span class="me-auto">Notes</span>
                        <i class="bi bi-pencil-square" data-bs-toggle="modal" data-bs-target="#"></i>
                    </div>
                    <div class="card-body">
                        <span id="cvNotes"></span>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>  

<!-- =======================================
Modals
======================================= -->
 <%#-  include("../../client/modal/edit")  %> 
 <%-  include("modal/Supply/supply")  %>
 <%-  include("modal/Expenses/expenses")  %>
 <%-  include("modal/Service/service")  %>
 <%-  include("modal/Payment/payment")  %>
 <%-  include("modal/Product/product")  %>

 

 <!-- =======================================
Scripts and accessories
======================================= -->
<%- include("../../partials/toaster") %>
<%- include("../../partials/script") %>


 <!-- =======================================
Scripts
======================================= -->
<!-- main script -->
<script src="../../../assets/js/transaction/inhouse/view.js"></script>
<script src="../../../assets/js/transaction/inhouse/modal/Supply/supply.js"></script>
<script src="../../../assets/js/transaction/inhouse/modal/Expenses/expenses.js"></script>
<script src="../../../assets/js/transaction/inhouse/modal/Service/service.js"></script>
<script src="../../../assets/js/transaction/inhouse/modal/Payment/payment.js"></script>
<script src="../../../assets/js/transaction/inhouse/modal/Product/product.js"></script>

<%- include("../../partials/footer") %>