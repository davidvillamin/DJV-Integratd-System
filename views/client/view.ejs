<%- include("../partials/header") %>
<%- include("../partials/loading") %>
<%- include("../partials/header-sidebar") %>
<!-- cv - Client View -->
<main id="main" class="main">
    <div class="pagetitle">
        <h1 id="cvFullName"></h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/client">Client</a></li>
                <li class="breadcrumb-item active">Client Profile</li>
            </ol>
        </nav>
    </div><!-- End Page Title -->

    <section class="section profile">
        <div class="row">
            <!-- =====================left side ===================-->
            <div class="col-xl-3">
                <!-- Over View -->
                <div class="card">
                    <div class="card-header">
                        Overview
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <strong>Balance</strong>
                            <strong><span>₱ </span>0.00</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            Credit
                            <p class="m-0">₱ 0.00</p>
                        </div>
                        <hr class="my-1">
                        <div class="d-flex justify-content-between">
                            Total Invoiced
                            <p class="m-0">₱ 0.00</p>
                        </div>
                        <hr class="my-1">
                        <div class="row">
                            <div class="col-6 d-flex flex-column align-items-center justify-content-center text-center">
                                <strong>Tickets</strong>
                                <p class="mb-0">Open: 0</p>
                                <p class="mb-0">Closed: 0</p>
                            </div>
                            <div class="col-6 d-flex flex-column align-items-center justify-content-center text-center">
                                <strong>Invoices</strong>
                                <p class="mb-0">Unpaid: 0</p>
                                <p class="mb-0">Total: 0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Information -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span>Customer Information</span>
                        <i class="bi bi-pencil-square ms-auto" data-bs-toggle="modal" data-bs-target="#cEditModal"></i>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4">
                                Email:
                            </div>
                            <div class="col-8">
                                <span id="cvEmail"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Contact Number:
                            </div>
                            <div class="col-8">
                                <span id="cvContactNumber"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Address:
                            </div>
                            <div class="col-8">
                                <span id="cvAddress"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                Created Date:
                            </div>
                            <div class="col-8">
                                <span id="cvCreatedDate"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="card">
                    <div class="card-header">
                        <span>Notes</span>
                    </div>
                    <div class="card-body">
                        <span id="cvNotes"></span>
                    </div>
                </div>
            </div>

            <!-- =====================Ceneter Content===================-->

            <div class="col-xl-6">
                <!-- Tickets -->
                <div class="card">
                    <div class="card-header">
                        Tickets
                    </div>
                    <div class="card-body">
                        <table id="cvTicketTable" class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Subject</th>
                                    <th>Created</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>501</td>
                                    <td>Security Alert – Possible Ransomware Detected</td>
                                    <td>09-13-25</td>
                                    <td>New</td>
                                </tr>
                                <tr>
                                    <td>502</td>
                                    <td>Slow Computer – Investigation Needed</td>
                                    <td>09-13-25</td>
                                    <td>In Progress</td>
                                </tr>
                                <tr>
                                    <td>503</td>
                                    <td>New Hire Onboarding – IT Setup Required</td>
                                    <td>09-13-25</td>
                                    <td>Waiting on Customer</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>  
                </div>
                <!-- Device -->
                <div class="card">
                    <div class="card-header d-flex">
                        <span>Devices</span>
                        <i class="bi bi-plus-circle ms-auto" data-bs-toggle="modal" data-bs-target="#diCreateModal"></i>
                    </div>
                    <div class="card-body">
                        <table id="cvDeviceTable" class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Serial</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>  
                </div>
                <!-- Contracts -->
                <div class="card">
                    <div class="card-header">
                        Contracts
                    </div>
                    <div class="card-body">
                        <table id="cvContractsTable" class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Start Date</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="text-center">There are no contracts available.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>  
                </div>
                <!-- Sales Transactions -->
                <div class="card">
                    <div class="card-header">
                        Sales Transactions
                    </div>
                    <div class="card-body">
                        <table id="cvTicketTable" class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Item</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" class="text-center">There are no sales available.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>  
                </div>

            </div>
            <!-- =================right side ===================-->
            <div class="col-xl-3">
                <!-- reminders -->
                <div class="card">
                    <div class="card-header">
                        Reminders
                    </div>
                    <div class="card-body">
                        <p class="fst-italic mb-0">No reminders available.</p>
                    </div>
                </div>
                <!-- appointments calendar -->
                <div class="card">
                    <div class="card-header">
                        Appointments
                    </div>
                    <div class="card-body">
                        <div id="miniCalendar" class="mini-calendar">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <button id="mcPrev" type="button" class="btn btn-sm btn-outline-secondary">&lt;</button>
                                <strong id="mcMonthYear" class="mx-2"></strong>
                                <button id="mcNext" type="button" class="btn btn-sm btn-outline-secondary">&gt;</button>
                            </div>

                            <table class="table table-sm mb-0">
                                <thead>
                                    <tr id="mcWeekdays" class="text-center small"></tr>
                                </thead>
                                <tbody id="mcDates"></tbody>
                            </table>
                        </div>

                        <style>
                            .mini-calendar td, .mini-calendar th { width: 2.2rem; height: 2.2rem; padding: 0.15rem; }
                            .mini-calendar td button { width: 100%; height: 100%; border: none; background: transparent; }
                            .mini-calendar td .today { background-color: #0d6efd; color: #fff; border-radius: 0.25rem; }
                            .mini-calendar td .muted { color: #6c757d; }
                            .mini-calendar td button:hover { background-color: rgba(13,110,253,0.08); border-radius: 0.25rem; }
                        </style>

                        <script>
                            (function () {
                                const weekdays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
                                const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
                                const mcMonthYear = document.getElementById('mcMonthYear');
                                const mcWeekdays = document.getElementById('mcWeekdays');
                                const mcDates = document.getElementById('mcDates');
                                const prevBtn = document.getElementById('mcPrev');
                                const nextBtn = document.getElementById('mcNext');

                                // render weekdays header
                                mcWeekdays.innerHTML = weekdays.map(d => '<th>' + d + '</th>').join('');

                                let today = new Date();
                                let viewYear = today.getFullYear();
                                let viewMonth = today.getMonth(); // 0-11

                                function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }
                                function render(){
                                    mcMonthYear.textContent = monthNames[viewMonth] + ' ' + viewYear;
                                    mcDates.innerHTML = '';

                                    const firstDay = new Date(viewYear, viewMonth, 1).getDay(); // 0-6
                                    const totalDays = daysInMonth(viewYear, viewMonth);
                                    let row = document.createElement('tr');
                                    let dayCount = 0;

                                    // leading blanks
                                    for (let i=0; i<firstDay; i++){
                                        row.appendChild(document.createElement('td'));
                                        dayCount++;
                                    }

                                    for (let d=1; d<=totalDays; d++){
                                        if (dayCount === 7){
                                            mcDates.appendChild(row);
                                            row = document.createElement('tr');
                                            dayCount = 0;
                                        }
                                        const td = document.createElement('td');
                                        const btn = document.createElement('button');
                                        btn.type = 'button';
                                        btn.textContent = d;

                                        // mark today
                                        if (viewYear === today.getFullYear() && viewMonth === today.getMonth() && d === today.getDate()){
                                            btn.classList.add('today');
                                        }

                                        btn.addEventListener('click', () => {
                                            // simple click behavior: highlight selected date and you can hook into appointment logic here
                                            const prev = mcDates.querySelectorAll('button.selected');
                                            prev.forEach(p => p.classList.remove('selected'));
                                            btn.classList.add('selected');
                                        });

                                        td.appendChild(btn);
                                        row.appendChild(td);
                                        dayCount++;
                                    }

                                    // trailing blanks
                                    while(dayCount > 0 && dayCount < 7){
                                        row.appendChild(document.createElement('td'));
                                        dayCount++;
                                    }
                                    mcDates.appendChild(row);
                                }

                                prevBtn.addEventListener('click', () => {
                                    viewMonth--;
                                    if (viewMonth < 0){ viewMonth = 11; viewYear--; }
                                    render();
                                });
                                nextBtn.addEventListener('click', () => {
                                    viewMonth++;
                                    if (viewMonth > 11){ viewMonth = 0; viewYear++; }
                                    render();
                                });

                                render();
                            })();
                        </script>
                    </div>
                </div>
                <!-- Attatchments -->
                <div class="card">
                    <div class="card-header">
                        Attatchments
                    </div>
                    <div class="card-body">
                        <p class="fst-italic mb-0">No reminders available.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<!-- End #main -->
<!-- modal -->
<%- include("modal/client/edit") %>
<%- include("../device/modal/create.ejs") %>

<!-- notification -->
<%- include("../partials/toaster") %>
<!-- dependencies -->
<%- include("../partials/script") %>

<script src="/assets/js/client/view.js"></script>
<script src="/assets/js/client/crud/client/edit.js"></script>
<script src="/assets/js/device/crud/create.js"></script>

<%- include("../partials/footer") %>